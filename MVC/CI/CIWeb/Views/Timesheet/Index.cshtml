@{
Layout = "_TopNavBar";
ViewData["Title"] = "Timesheet";
}
<!DOCTYPE html>
<html lang="en">
   <head>
      <meta charset="UTF-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Document</title>
      <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha2/dist/css/bootstrap.min.css" rel="stylesheet"
         integrity="sha384-aFq/bzH65dt+w6FI2ooMVUpc+21e0SRygnTpmBvdBgSdnuTN7QbdgL+OapgHtvPp" crossorigin="anonymous">
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.4/font/bootstrap-icons.css">
      <link rel="stylesheet" href="~/css/Volunteeringtimesheet.css" asp-append-version="true" />
      <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
   </head>
   <body>
      <div class="container timesheet">
         <div class="row ">
            <label class="fs-4" style="margin-left: 85px;"> Volunteering Timesheet</label>
         </div>
         <div class="row d-flex justify-content-center ">
            <div class="col-12 col-xl-5 col-lg-5 mt-4 borderbox">
               <div class="row cardtitleborder">
                  <div class="col-8 d-flex align-items-center">
                     <label class="fs-5"> Volunteering Hour</label>
                  </div>
                  <div class="col-4">
                     <button class="rounded-pill d-flex justify-content-center align-items-center ms-auto py-2 px-4 me-2 my-2 addbtn" data-bs-toggle="modal" data-bs-target="#TimeADDbtn">
                     <i class="bi bi-plus-lg me-2 "></i>
                     <span> ADD</span>
                     </button>
                     <div class="modal fade" id="TimeADDbtn" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                        <div class="modal-dialog modal-lg modal-dialog-centered">
                           <div class="modal-content">
                             
                                 <div class="modal-header">
                                    <h1 class="modal-title fs-5" id="exampleModalLabel">Please input below Volunteering Hours</h1>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                 </div>
                                 <div class="modal-body">
                                    <div class="container">
                                       <div class="row">
                                          <lable class="col-6 fs-6">Mission</lable>
                                          <select id="mission-add-time" class=" datediv py-1 ro col-12" aria-label="Default select example">
                                             
                                          </select>
                                       </div>
                                       <div class="row mt-2">
                                          <lable class="col-6 fs-6">Date Volunteered</lable>
                                          <input class="col-12 datediv py-1 rounded-1" type="datetime-local" id="mission-dateVolunteered-time"/>
                                       </div>
                                       <div class="row mt-1 ">
                                          <div class=" col-12 col-xl-6 col-1g-6 p-0">
                                             <label class=" col-8 fs-6"> Hours</label>
                                             <input type="number" min="0" max="23" placeholder="Enter Spent Hours " id="mission-Hours-time" class="py-1 datediv rounded-1 w-100 " />
                                          </div>
                                          <div class=" col-12 col-xl-6 col-1g-6 p-0 ">
                                             <label class=" col-8 fs-6"> Minutes</label>
                                             <input  type="number" min="0" max="59" placeholder="Enter Spent Minutes " id="mission-min-time" class=" ms-0 ms-xl-2 py-1 datediv rounded-1 w-100 me-2" />
                                          </div>
                                       </div>
                                       <div class="row mt-1">
                                          <label class=" col-8 fs-6"> Enter Your Message</label>
                                          <textarea class=" datediv rounded-1 mt-1 " placeholder="Leave a comment here" id="mission-Message-time"></textarea>
                                       </div>
                                    </div>
                                 </div>
                                 <div class="modal-footer">
                                    <button type="button" class="rounded-pill bg-white px-3 py-1" data-bs-dismiss="modal">Cancel</button>
                                    <button type="submit" class="rounded-pill addbtn px-3 py-1" onclick="timeSubmit()">Submit</button>
                                 </div>
                              
                           </div>
                        </div>
                     </div>
                     <div class="modal fade" id="TimeADDbtn1" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                        <div class="modal-dialog modal-lg modal-dialog-centered">
                           <div class="modal-content">
                              <form >
                                 <div class="modal-header">
                                    <h1 class="modal-title fs-5" id="exampleModalLabel">Please input below Volunteering Hours</h1>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                 </div>
                                 <div class="modal-body">
                                    <div class="container">
                                       <div class="row">
                                          <lable class="col-6 fs-6">Mission</lable>
                                          <select id="mission1" class=" datediv py-1 ro col-12" aria-label="Default select example">
                                             <option value="1">1 Title</option>
                                          </select>
                                       </div>
                                       <div class="row mt-2">
                                          <lable class="col-6 fs-6">Date Volunteered</lable>
                                          <input class="col-12 datediv py-1 rounded-1" id="date1" type="datetime-local" />
                                       </div>
                                       <div class="row mt-1 ">
                                          <div class=" col-12 col-xl-6 col-1g-6 p-0">
                                             <label class=" col-8 fs-6"> Hours</label>
                                             <input type="number" min="0" max="23" placeholder="Enter Spent Hours " class="py-1 datediv rounded-1 w-100 " id="hour1" />
                                          </div>
                                          <div class=" col-12 col-xl-6 col-1g-6 p-0 ">
                                             <label class=" col-8 fs-6"> Minutes</label>
                                             <input id="minute1" type="number" min="0" max="59" placeholder="Enter Spent Minutes " class=" ms-0 ms-xl-2 py-1 datediv rounded-1 w-100 me-2" />
                                          </div>
                                          <input type="hidden" id="timesheetid1" />
                                       </div>
                                       <div class="row mt-1">
                                          <label class=" col-8 fs-6"> Enter Your Message</label>
                                          <textarea id="notes" class=" datediv rounded-1 mt-1 " placeholder="Leave a comment here" id="floatingTextarea"></textarea>
                                       </div>
                                    </div>
                                 </div>
                                 <div class="modal-footer">
                                    <button type="button" class="rounded-pill bg-white px-3 py-1" data-bs-dismiss="modal">Cancel</button>
                                    <button type="submit" class="rounded-pill addbtn px-3 py-1" id="time-based-submit" onclick="timeSubmit()">Submit</button>
                                 </div>
                              </form>
                           </div>
                        </div>
                     </div>
                  </div>
               </div>
               <div class="row table-responsive timesheetdiv">
                  <table class="table table-borderless">
                     <thead>
                        <tr>
                           <th scope="col">Mission</th>
                           <th scope="col">Date </th>
                           <th scope="col">Hour</th>
                           <th scope="col">Minute</th>
                           <th scope="col"></th>
                           <th scope="col"></th>
                        </tr>
                     </thead>
                     <tbody id="time-based-timesheets">
                        <tr>
                           
                        </tr>
                     </tbody>
                  </table>
               </div>
            </div>
            <div class="col-12 col-xl-5 col-lg-5 ms-0 ms-xl-4 ms-lg-4 mt-4 borderbox">
               <div class="row cardtitleborder">
                  <div class="col-8 d-flex align-items-center">
                     <label class="fs-5"> Volunteering Hour</label>
                  </div>
                  <div class="col-4">
                     <button class="rounded-pill d-flex justify-content-center align-items-center py-2 px-4 ms-auto me-2 my-2 addbtn" data-bs-toggle="modal" data-bs-target="#GoalADDbtn">
                     <i class="bi bi-plus-lg me-2 "></i>
                     <span> ADD</span>
                     </button>
                     <div class="modal fade" id="GoalADDbtn" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                        <div class="modal-dialog modal-lg modal-dialog-centered">
                           <div class="modal-content">
                              <form>
                                 <div class="modal-header">
                                    <h1 class="modal-title fs-5" id="exampleModalLabel">Please input below Volunteering Goal</h1>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                 </div>
                                 <div class="modal-body">
                                    <div class="container">
                                       <div class="row">
                                          <lable class="col-6 fs-6">Mission</lable>
                                          <select id="mission2" class=" datediv py-1 ro col-12" aria-label="Default select example">
                                             <option value="1">1 title</option>
                                          </select>
                                       </div>
                                       <div class="row mt-2">
                                          <lable class="col-6 fs-6">Action</lable>
                                          <input class="col-12 datediv py-1 rounded-1" placeholder="Enter Actions" type="text" />
                                       </div>
                                       <div class="row mt-1 ">
                                          <label class=" col-8 fs-6"> Date of Volunteered</label>
                                          <input type="datetime-local" placeholder="Enter Date " class="py-1 datediv rounded-1 col-12 " />
                                       </div>
                                       <div class="row mt-1">
                                          <label class=" col-8 fs-6"> Enter Your Message</label>
                                          <textarea class=" datediv rounded-1 mt-1 " placeholder="Leave a comment here" id="floatingTextarea"></textarea>
                                       </div>
                                    </div>
                                 </div>
                                 <div class="modal-footer">
                                    <button type="button" class="rounded-pill bg-white px-3 py-1" data-bs-dismiss="modal">Cancel</button>
                                    <button type="submit" class="rounded-pill addbtn px-3 py-1">Submit</button>
                                 </div>
                              </form>
                           </div>
                        </div>
                     </div>
                     <div class="modal fade" id="GoalADDbtn1" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                        <div class="modal-dialog modal-lg modal-dialog-centered">
                           <div class="modal-content">
                              <form >
                                 <div class="modal-header">
                                    <h1 class="modal-title fs-5" id="exampleModalLabel">Please input below Volunteering Goal</h1>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                 </div>
                                 <div class="modal-body">
                                    <div class="container">
                                       <div class="row">
                                          <lable class="col-6 fs-6">Mission</lable>
                                          <select  class=" datediv py-1 ro col-12" aria-label="Default select example">
                                             <option value="1">1 title</option>
                                          </select>
                                       </div>
                                       <div class="row mt-2">
                                          <lable class="col-6 fs-6">Action</lable>
                                          <input id="action1" class="col-12 datediv py-1 rounded-1" placeholder="Enter Actions" type="text" />
                                       </div>
                                       <div class="row mt-1 ">
                                          <label class=" col-8 fs-6"> Date of Volunteered</label>
                                          <input type="datetime-local" id="date2" placeholder="Enter Date " class="py-1 datediv rounded-1 col-12 " />
                                       </div>
                                       <input type="hidden" id="timesheetid2" />
                                       <div class="row mt-1">
                                          <label class=" col-8 fs-6"> Enter Your Message</label>
                                          <textarea id="notes1" class=" datediv rounded-1 mt-1 " placeholder="Leave a comment here" id="floatingTextarea"></textarea>
                                       </div>
                                    </div>
                                 </div>
                                 <div class="modal-footer">
                                    <button type="button" class="rounded-pill bg-white px-3 py-1" data-bs-dismiss="modal">Cancel</button>
                                    <button class="submitGoal rounded-pill addbtn px-3 py-1" type="submit">Submit</button>
                                 </div>
                              </form>
                           </div>
                        </div>
                     </div>
                  </div>
               </div>
               <div class="row overflow-y-auto goalsheetdiv" style="height:300px;">
                  <table class="table table-borderless">
                     <thead>
                        <tr>
                           <th scope="col">Mission</th>
                           <th scope="col">Date </th>
                           <th scope="col">Action</th>
                           <th scope="col"></th>
                           <th scope="col"></th>
                        </tr>
                     </thead>
                     <tbody id="goal-based-timesheets">
                        <tr>
                           <td>title</td>
                           <td>date</td>
                           <td>action</td>
                           <td class="d-flex align-items-center mt-1"> <i class="bi bi-pencil-square editimg" data-bs-toggle="modal" data-bs-target="#GoalADDbtn1" id="" onclick="editgoalsheet()"></i></td>
                           <td> <img src="~/img/bin.png" id="" onclick="deletegoalsheet()" /></td>
                        </tr>
                     </tbody>
                  </table>
               </div>
            </div>
         </div>
      </div>
   </body>
   <script>

       function loadTimeSheets(response) {
           return response.timeSheets.map(item => `
                        <tr>
                           <td>${item.mission}</td>
                           <td>${item.dateVolunteered.toString().split("T")[0]}</td>
                           <td>${item.timesheetTime.toString().split(":")[0]}</td>
                           <td>${item.timesheetTime.toString().split(":")[1]}</td>
                           <td class="d-flex align-items-center mt-1"> <i class="bi bi-pencil-square editimg" data-bs-toggle="modal" data-bs-target="#TimeADDbtn1" id="" onclick=""></i></td>
                           <td> <img src="/img/bin.png" id="${item.timesheetId}" onclick="deletetimesheet(this.id)" /></td>
                        </tr>`).join("")
       }

       function loadGoalSheets(response) {
           return response.goalSheets.map(item => `
                        <tr>
                           <td>${item.mission}</td>
                           <td>${item.dateVolunteered.toString().split("T")[0]}</td>
                           <td>${item.action}</td>
                           <td class="d-flex align-items-center mt-1"> <i class="bi bi-pencil-square editimg" data-bs-toggle="modal" data-bs-target="#TimeADDbtn1" id="" onclick=""></i></td>
                           <td> <img src="/img/bin.png" id="${item.timesheetId}" onclick="deletetimesheet(this.id)" /></td>
                        </tr>`).join("")
       }

       $.ajax({
           type: "GET",
           url: `/api/timesheets`,
           success: function (response) {

               console.log(response)

               var timeBasedTimeSheets = document.getElementById("time-based-timesheets");
               timeBasedTimeSheets.innerHTML = loadTimeSheets(response);

               var goalBasedTimeSheets = document.getElementById("goal-based-timesheets");
               goalBasedTimeSheets.innerHTML = loadGoalSheets(response);

           },
           failure: function (response) {
                alert(response.responseText);
           },
           error: function (response) {
                alert(response.responseText);
           }
       });

       function loadAppliedMissions(response) {
            var html = "<option disabled selected>Select Mission</option>";
            response.mission.map(item => html += `<option value="${item.id}">${item.title}</option>`).join("")

            return html;
       }

       // load applied missions
       $.ajax({
            type: "GET",
            url: `/story/sharestory/getmission`,
            success: function (response) {

                console.log(response)

                var mission1 = document.getElementById("mission-add-time");
                mission1.innerHTML = loadAppliedMissions(response);
                var mission2 = document.getElementById("mission2");
                mission2.innerHTML = loadAppliedMissions(response);

            },
            failure: function (response) {
                alert(response.responseText);
            },
            error: function (response) {
                alert(response.responseText);
            }
       });

       function deletetimesheet(id) {
           console.log(id)

           $.ajax({
                type: "GET",
                url: `/api/timesheets/delete`,
                data: {
                    "id" : id
                },
                success: function (response) {

                    location.reload();

                },
                failure: function (response) {
                    alert(response.responseText);
                },
                error: function (response) {
                    alert(response.responseText);
                }
            });
       }

       function timeSubmit(){

           var missionId = document.getElementById("mission-add-time").value;
           var dateVolunteered = document.getElementById("mission-dateVolunteered-time").value;
           var Hours = document.getElementById("mission-Hours-time").value;
           var min = document.getElementById("mission-min-time").value;
           var Message = document.getElementById("mission-Message-time").value;
           console.log(missionId, dateVolunteered, Hours, min, Message, Hours+":"+min+":"+"00")

           $.ajax({
                type: "GET",
                url: `/api/timesheets/add`,
                data: {
                    "missionId" : missionId,
                    "dateVolunteered" : dateVolunteered,
                    "notes" : Message,
                    "timesheetTime" : Hours+":"+min+":"+"00"
                },
                success: function (response) {

                    location.reload();

                },
                failure: function (response) {
                    alert(response.responseText);
                },
                error: function (response) {
                    alert(response.responseText);
                }
            });
       }

       function goalSubmit(){

           var missionId = document.getElementById("mission-add-time").value;
           var dateVolunteered = document.getElementById("mission-dateVolunteered-time").value;
           var Hours = document.getElementById("mission-Hours-time").value;
           var min = document.getElementById("mission-min-time").value;
           var Message = document.getElementById("mission-Message-time").value;
           console.log(missionId, dateVolunteered, Hours, min, Message, Hours+":"+min+":"+"00")

           $.ajax({
                type: "GET",
                url: `/api/timesheets/add`,
                data: {
                    "missionId" : missionId,
                    "dateVolunteered" : dateVolunteered,
                    "notes" : Message,
                    "timesheetTime" : Hours+":"+min+":"+"00"
                },
                success: function (response) {

                    location.reload();

                },
                failure: function (response) {
                    alert(response.responseText);
                },
                error: function (response) {
                    alert(response.responseText);
                }
            });
       }



   </script>
</html>