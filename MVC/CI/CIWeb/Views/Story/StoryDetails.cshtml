@{
    Layout = "_TopNavBar";
    ViewData["Title"] = "Stories";
}

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stories</title>
    <link rel="stylesheet" href="~/css/StoryDetails.css">
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>

    <style>
        .storyUser {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .storyRightContent {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .viewsContainer {
            display: flex;
            justify-content: center;
            align-items: center;
            border: 1px solid #E8E8E8;
            border-radius: 19px;
            padding: 2px 15px;
        }

        .OpenMission {
            border-radius: 25px;
            color: #F88634;
            border-color: #F88634;
            background-color: #ffffff;
            border: 2px solid #F88634;
            font-size: 17px;
            padding: 5px 0px;
            width: 93%;
            text-decoration: none;
        }

        .storyTitle {
            font-weight: 350;
            font-size: 2em;
            border-bottom: 2px solid #000000;
            width: fit-content;
        }

        .volunteering_image_content,
        .volunteering_main_tabs_content {
            padding: 0px 8.5rem;
            margin: 0%;
        }

        .main_volunteering_image img {
            width: 100%;
            height: 50vh;
        }

        .carousel-control-next,
        .carousel-control-prev {
            width: 0%;
        }

        .carousel-inner .carousel-item.active,
        .carousel-inner .carousel-item-next,
        .carousel-inner .carousel-item-prev {
            display: flex;
        }

        .carousel-inner .carousel-item-end.active,
        .carousel-inner .carousel-item-next {
            transform: translateX(25%);
        }

        .carousel-inner .carousel-item-start.active,
        .carousel-inner .carousel-item-prev {
            transform: translateX(-25%);
        }

        .carousel-inner .carousel-item-end,
        .carousel-inner .carousel-item-start {
            transform: translateX(0);
        }

        .smallSliderImageHeight {
            height: 12.5vh;
        }

        .control_custom_changes_carousel {
            width: 5%;
            background: black !important;
            opacity: 0.6 !important;
            margin: 0px 12px 0px 12px;
        }

            .control_custom_changes_carousel:hover {
                opacity: 0.8 !important;
            }

        .imageContainer {
            display: grid;
            height: fit-content;
        }
    </style>

</head>

<body>

    <div class="container" style="margin-top:75px">
        <div class="row  p-0 mt-4">
            <div class="col-12 col-lg-6 imageContainer" id="imageContainer">
                <div class="one" style="margin-bottom: 1px;">
                    <div class="main_volunteering_image" id="story-details-head-img">
                        
                    </div>
                </div>
                <div class="two" style="margin: 10px; margin-top: 1px;">
                    <div class="text-center" style="margin-left: 0px; margin-right: 0px;padding: 0px; width: 100%;">
                        <div class="row justify-content-center">
                            <div id="recipeCarousel" class="carousel slide p-0" data-bs-ride="carousel">
                                <div class="carousel-inner" role="listbox" id="story-details-carousel">

                                   


                                </div>

                                <a class="carousel-control-prev m-0 control_custom_changes_carousel bg-transparent w-aut"
                                   href="#recipeCarousel" role="button" data-bs-slide="prev">
                                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                </a>
                                <a class="carousel-control-next m-0 control_custom_changes_carousel bg-transparent w-aut"
                                   href="#recipeCarousel" role="button" data-bs-slide="next">
                                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-12 col-lg-6 mt-4">
                <div class="storyRightContent">
                    <div class="storyUser" id="story-details-user-details">

                        <img src="~/img/volunteer2.png" class="commentImage" alt="" style="border-radius:50%;height:80px;width:80px">
                        <p class="text-muted">FirstName LastName</p>

                    </div>
                    <div>
                        <div class="viewsContainer">
                            <img src="~/img/eye.png" alt="">
                            <p class="p-0 text-muted" style="margin-left: 10px;margin-bottom: 0px;"><span id="countUser">0</span> Views</p>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <p class="storyDescription" id="story-details-why-i-voluntter">
                        
                    </p>
                </div>
                <div class="row buttonROW mt-4">
                    <div class="col-8">
                        <center>
                            <!-- Share Model -->
                            <!-- Button trigger modal -->
                            <button type="button" class="OpenMission" data-bs-toggle="modal" data-bs-target="#exampleModal"><img src="~/img/add1.png" style="width: 15px;height: 15px;padding-bottom: 3px;" alt="">&nbsp;&nbsp;<span class="recommText">Recommend to a Co-Worker</span></button>


                            <!-- Vertically centered scrollable modal -->
                            <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                <div class="modal-dialog modal-dialog-centered">
                                    <div class="modal-content">
                                        <div class="modal-header d-flex justify-content-around" style="border: none">
                                            <h1 class="modal-title fs-5" id="exampleModalLabel">Recommend to a Co-Worker</h1>
                                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                        </div>
                                        <div class="modal-body">
                                            @*<form class="form-inline">
                                                <div class="row mb-3">
                                                    <div class="col-5">
                                                        <input class="form-control mr-sm-2" id="userSearch" type="search" placeholder="Search User" aria-label="Search" onkeyup="searchUserByName()" autocomplete="off">
                                                    </div>
                                                    <div class="col-1 p-0 d-flex justify-content-start align-items-center">
                                                        <img src="~/img/search.png" id="searchSearchbar" style="height: 20px;" alt="">
                                                    </div>
                                                    <div class="col-6"></div>
                                                </div>
                                            </form>*@
                                            <div class="row m-5" id="noUser">
                                                <div class="col">
                                                    <h3 class="text-danger">User not found.</h3>
                                                </div>
                                            </div>

                                            <hr class="m-0" />
                                            <div class="row m-2 userListRow" id="story-details-recommend-user">
                                                <div class="d-flex justify-content-center">
                                                    <div class="col-1 d-flex align-items-center justify-content-center">
                                                        <img src="~/img/volunteer3.png" class="commentImage m-0 rounded-circle" alt="">
                                                    </div>
                                                    <div class="col-8 userFlex d-flex flex-column align-item-center">
                                                        <h5 class="m-0 userName">FirstName LastName</h5>
                                                        <p class="m-0 text-muted">Department</p>
                                                    </div>
                                                    <div class="col-3 d-flex align-items-center justify-content-center">
                                                        <center id="inviteButtonModel">
                                                            <a role="button" style="text-decoration:none" id="Email" data-email="Email" class="applyButton">Invite</a>
                                                        </center>
                                                    </div>
                                                </div>
                                            </div>

                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- Share Model -->
                        </center>
                    </div>
                    <div class="col-4">
                        <center id="story-details-mission-btn">
                            <a asp-action="Index" asp-controller="Volunteer" asp-route-id="4" type="button" class="OpenMission" style="color: #F88634;"><span class="addText">Open Mission&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><img src="~/img/right-arrow.png" alt=""></a>
                        </center>
                    </div>
                </div>
            </div>
        </div>
        <div class="row mt-4">
            <div class="col" id="story-detail-title-desc">
                <p class="storyTitle pb-3">
                    Title
                </p>
                <p class="storyDescription">Description</p>

            </div>

        </div>
    </div>
    <hr>
        <div class="container mt-3 mb-5">
            Privacy policy
        </div>
    <script src="~/lib/jquery/dist/jquery.js"></script>
    <script>
        function changeImage(imgNumber) {
            var img = document.getElementById("img" + imgNumber);
            var img0 = document.getElementById("img0");
            img0.src = img.src;
        }

        // searchUserByName()
        var noUser = document.getElementById("noUser");
        noUser.style.display = "none";

        function searchUserByName() {
            let input = document.getElementById("userSearch").value
            input = input.toLowerCase();
            let name = document.getElementsByClassName("userName");
            let x = document.getElementsByClassName("userListRow");
            noUser.style.display = "none";
            var found = false;

            for (i = 0; i < name.length; i++) {
                if ((name[i].innerHTML.toLowerCase().includes(input))) {
                    x[i].style.display = "";
                    found = true;
                }
                else {
                    x[i].style.display = "none";
                }
            }

            if (found == true) {
                noUser.style.display = "none";
            } else {
                noUser.style.display = "";
            }
        }

        // Invite User In Bootstrap Model
        function inviteUser(userId){
            
            var url = window.location.href;
            var userStoryId = url.split("/")[4];

            var element = document.getElementById(userId);
            element.innerHTML = `<div class="spinner-border" role="status">
                                  <span class="visually-hidden">Loading...</span>
                                </div>`

            $.ajax({
                type: "GET",
                url: "/Story/InviteUser",
                data: { userId: userId, storyId: userStoryId },
                success: function (response) {

                    if(response.res == true) {
                        
                        element.innerHTML = `Email Sent`;
                        
                    }
                }
            })
        };

        var url = window.location.href;
        var storyId = url.split("/")[4];

        function loadHeadImage(response) {

            var notfound = "/img/404-Page-image.png";
            var storyPath = "";
            if (response.model.storyMedia != null && response.model.storyMedia[0] != null &&response.model.storyMedia[0].storyPath != null) {
                storyPath = "/mediaUpload/" + response.model.storyMedia[0].storyPath;
            } else {
                storyPath = notfound;
            }

            return `<img src="${storyPath}" style="height: 350px;" alt="" id="img0">`
        }

        function loadCarouselImage(response) {

            var html = ""
            if(response.model.storyMedia != null && response.model.storyMedia.length <=1) {
                html = ""
            } else {
                console.log(response);
                response.model.storyMedia.map(item => {

                    if(item.storyType == "png") {
                    html += `<div class="carousel-item">
                                        <div class="col-md-3">
                                            <div class="card">
                                                <div class="card-img">
                                                    <img src="/mediaUpload/${item.storyPath}" class="img-fluid smallSliderImageHeight" style="height: 12.5vh" onclick="changeImage(${item.storyMediaId})" id="img${item.storyMediaId}">
                                                </div>
                                            </div>
                                        </div>
                                    </div> `
                                    }
                })
            }

            return html;
        }

        $.ajax({
                type: "GET",
                url: `/api/story/${storyId}`,
                success: function (response) {

                    var user = document.getElementById("story-details-user-details");
                    user.innerHTML = `<img src="/mediaUpload/${response.model.avatar}" class="commentImage" alt="" style="border-radius:50%;height:80px;width:80px">
                                        <p class="text-muted">${response.model.userName}</p>`;

                    var whyIVolunteer = document.getElementById("story-details-why-i-voluntter");
                    whyIVolunteer.innerHTML = `<p>${response.model.whyIVolunteer}</p>`;

                    var titleNDesc = document.getElementById("story-detail-title-desc");
                    titleNDesc.innerHTML = `<p class="storyTitle pb-3">
                                                ${response.model.missionTitle}
                                            </p>
                                            <p class="storyDescription">${response.model.storyDetails}</p>`;

                    var missionBtn = document.getElementById("story-details-mission-btn");
                    missionBtn.innerHTML = `<a href="/missions/${response.model.missionId}" type="button" class="OpenMission" style="color: #F88634;"><span class="addText">Open Mission&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><img src="/img/right-arrow.png" alt=""></a>`

                    var views = document.getElementById("countUser");
                    countUser.innerHTML = `${response.model.views}`

                    var imageContainer = document.getElementById("story-details-head-img");
                    imageContainer.innerHTML = loadHeadImage(response);
                    
                    var imageCarousel = document.getElementById("story-details-carousel");
                    imageCarousel.innerHTML = loadCarouselImage(response);

                    // Attached class active to image slider for working slider properly
                    var image = document.getElementsByClassName("carousel-item");
                    if(image[0]!=null) {
                        image[0].classList.add('active');

                        let items = document.querySelectorAll('.carousel .carousel-item')

                        items.forEach((el) => {
                            const minPerSlide = 4
                            let next = el.nextElementSibling
                            for (var i = 1; i < minPerSlide; i++) {
                                if (!next) {
                                    // wrap carousel by using first child
                                    next = items[0]
                                }
                                let cloneChild = next.cloneNode(true)
                                el.appendChild(cloneChild.children[0])
                                next = next.nextElementSibling
                            }
                        })
                    }


                    

                },
                failure: function (response) {
                    alert(response.responseText);
                },
                error: function (response) {
                    alert(response.responseText);
                }
            });

            function loadUsers(response) {
                return response.user.map(item => `<div class="d-flex justify-content-center">
                                                    <div class="col-1 d-flex align-items-center justify-content-center">
                                                        <img src="/img/${item.avatar}" class="commentImage m-0 rounded-circle" alt="" style="width:50px;height:50px">
                                                    </div>
                                                    <div class="col-8 userFlex d-flex justify-content-center align-items-center">
                                                        <h5 class="m-0 userName">${item.firstName} ${item.lastName}</h5>
                                                        
                                                    </div>
                                                    <div class="col-3 d-flex align-items-center justify-content-center">
                                                        <center id="inviteButtonModel">
                                                            <a role="button" style="text-decoration:none;" id="${item.userId}" data-email="${item.userId}" class="applyButton" onclick="inviteUser(${item.userId})">Invite</a>
                                                        </center>
                                                    </div>
                                                </div>
                                                <hr class="mt-2"/>`).join("");
            }


            $.ajax({
                type: "GET",
                url: `/users`,
                success: function (response) {
                    var element = document.getElementById("story-details-recommend-user");
                    element.innerHTML = loadUsers(response);
                },
                failure: function (response) {
                    alert(response.responseText);
                },
                error: function (response) {
                    alert(response.responseText);
                }
            });


    </script>
</body>

</html>